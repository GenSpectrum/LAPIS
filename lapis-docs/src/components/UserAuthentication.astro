---
import { Code, Aside } from '@astrojs/starlight/components';
import { getLapisUrl } from '../lapisUrl';
import { OnlyIf } from './OnlyIf.tsx';

const lapisUrl = getLapisUrl();

async function instanceRequiresAuthentication() {
    try {
        const response = await fetch(`${lapisUrl}/sample/info`);
        return response.status === 401;
    } catch (error) {
        console.error('Error checking authentication requirement:', error);
        return false;
    }
}

const requiresAuth = await instanceRequiresAuthentication();
---

<Aside type='note'
    >This LAPIS instance <b>{requiresAuth ? 'requires' : 'does not require'} authentication</b> to access its data.</Aside
>

<p>
    Some LAPIS instances require authentication to access their data. If an instance is configured with authentication,
    you need to include a valid access token in your requests.
</p>

<h2>Checking if Authentication is Required</h2>
<p>Try accessing any endpoint without authentication:</p>

<Code lang='bash' code={`curl ${lapisUrl}/sample/info -v`} />
<p>
    If authentication is required, you'll receive a <code>401 Unauthorized</code> response and the output will contain something
    like
</p>
<Code code='> ...\n< HTTP/1.1 401\n< ...' />

<p>If the instance is open (no authentication), you'll receive the normal response data.</p>

<h2>Getting an Access Token</h2>

<p>
    Contact the LAPIS instance administrator to learn how to obtain an access token. The method depends on the identity
    provider configured for that instance. Common methods include:
</p>
<ul>
    <li><b>Username/password</b> - Exchange credentials for a token</li>
    <li><b>Client credentials</b> - Use a client ID and secret</li>
    <li><b>OAuth 2.0 flows</b> - Authorization code, device flow, etc.</li>
</ul>

<h2>Making Authenticated Requests</h2>
<p>
    To make authenticated requests to LAPIS, include the access token in the <code>Authorization</code> header using the <code
        >Bearer</code
    > scheme:

    <Code lang='bash' code={`curl -H "Authorization: Bearer YOUR_ACCESS_TOKEN" ${lapisUrl}/sample/aggregated`} />
</p>
